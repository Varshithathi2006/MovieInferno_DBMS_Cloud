"use strict";(()=>{var e={};e.id=186,e.ids=[186],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},6390:(e,r,s)=>{s.r(r),s.d(r,{originalPathname:()=>f,patchFetch:()=>j,requestAsyncStorage:()=>w,routeModule:()=>v,serverHooks:()=>x,staticGenerationAsyncStorage:()=>m});var t={};s.r(t),s.d(t,{DELETE:()=>c,GET:()=>d,POST:()=>p,PUT:()=>l});var o=s(3277),i=s(5265),n=s(5356),a=s(7076),u=s(2303);async function d(e){try{let{searchParams:r}=new URL(e.nextUrl),s=r.get("movieId");if(!s)return a.NextResponse.json({error:"Movie ID is required"},{status:400});let{data:t,error:o}=await u.O.from("reviews").select(`
        id,
        user_id,
        movie_id,
        rating,
        comment,
        created_at,
        users (
          email,
          username
        )
      `).eq("movie_id",s).order("created_at",{ascending:!1});if(o)return console.error("Error fetching reviews:",o),a.NextResponse.json({error:"Failed to fetch reviews"},{status:500});return a.NextResponse.json(t)}catch(e){return console.error("Error in GET /api/reviews:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}async function p(e){try{let{user_id:r,movie_id:s,rating:t,comment:o}=await e.json();if(!r||!s||!t||!o)return a.NextResponse.json({error:"Missing required fields: user_id, movie_id, rating, comment"},{status:400});if(t<1||t>10)return a.NextResponse.json({error:"Rating must be between 1 and 10"},{status:400});let{data:i}=await u.O.from("reviews").select("id").eq("user_id",r).eq("movie_id",s).single();if(i)return a.NextResponse.json({error:"You have already reviewed this movie",exists:!0},{status:409});let{data:n,error:d}=await u.O.from("reviews").insert({user_id:r,movie_id:s,rating:t,comment:o,created_at:new Date().toISOString()}).select().single();if(d)return console.error("Error adding review:",d),a.NextResponse.json({error:"Failed to add review"},{status:500});return a.NextResponse.json({message:"Review posted successfully!",data:n},{status:201})}catch(e){return console.error("Error in POST /api/reviews:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}async function l(e){try{let{id:r,user_id:s,rating:t,comment:o}=await e.json();if(!r||!s||!t||!o)return a.NextResponse.json({error:"Missing required fields: id, user_id, rating, comment"},{status:400});if(t<1||t>10)return a.NextResponse.json({error:"Rating must be between 1 and 10"},{status:400});let{data:i,error:n}=await u.O.from("reviews").update({rating:t,comment:o,updated_at:new Date().toISOString()}).eq("id",r).eq("user_id",s).select().single();if(n)return console.error("Error updating review:",n),a.NextResponse.json({error:"Failed to update review"},{status:500});if(!i)return a.NextResponse.json({error:"Review not found or unauthorized"},{status:404});return a.NextResponse.json({message:"Review updated successfully!",data:i})}catch(e){return console.error("Error in PUT /api/reviews:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}async function c(e){try{let{id:r,user_id:s}=await e.json();if(!r||!s)return a.NextResponse.json({error:"Missing required fields: id, user_id"},{status:400});let{data:t,error:o}=await u.O.from("reviews").delete().eq("id",r).eq("user_id",s).select();if(o)return console.error("Error deleting review:",o),a.NextResponse.json({error:"Failed to delete review"},{status:500});if(0===t.length)return a.NextResponse.json({error:"Review not found or unauthorized"},{status:404});return a.NextResponse.json({message:"Review deleted successfully",data:t[0]})}catch(e){return console.error("Error in DELETE /api/reviews:",e),a.NextResponse.json({error:"Internal server error"},{status:500})}}let v=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/reviews/route",pathname:"/api/reviews",filename:"route",bundlePath:"app/api/reviews/route"},resolvedPagePath:"C:\\Users\\varshitha-home\\Desktop\\last_hope\\MovieInferno\\movieinferno-deploy-v6-fixes\\app\\api\\reviews\\route.js",nextConfigOutput:"",userland:t}),{requestAsyncStorage:w,staticGenerationAsyncStorage:m,serverHooks:x}=v,f="/api/reviews/route";function j(){return(0,n.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:m})}},2303:(e,r,s)=>{s.d(r,{O:()=>t});let t=(0,s(2751).eI)("https://ajnkisostsjhoqfyjsqu.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFqbmtpc29zdHNqaG9xZnlqc3F1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzOTY0MjQsImV4cCI6MjA3MTk3MjQyNH0.KMvKbgeF2xeCwrFSGXHA0NLqZ9_94kIBs0CiSjkuBkg")}};var r=require("../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[916,578,76],()=>s(6390));module.exports=t})();